# Пресеты кодировщиков для foobar2000 на macOS
# Оптимизировано для Homebrew установок и macOS путей

[Encoder Presets для macOS]
created_date=$(date '+%Y-%m-%d %H:%M:%S')
platform=macOS
homebrew_prefix=/opt/homebrew  # Для Apple Silicon
homebrew_prefix_intel=/usr/local  # Для Intel Mac

# FLAC Lossless - максимальное качество
[flac_lossless]
name=FLAC Lossless (macOS)
description=Максимальное сжатие FLAC с полными метаданными для macOS
encoder_path_arm64=/opt/homebrew/bin/flac
encoder_path_intel=/usr/local/bin/flac
extension=flac
parameters=-8 -V --totally-silent --preserve-modtime --keep-foreign-metadata -T "ARTIST=%artist%" -T "TITLE=%title%" -T "ALBUM=%album%" -T "DATE=%date%" -T "GENRE=%genre%" -T "TRACKNUMBER=%tracknumber%" -T "ALBUMARTIST=%albumartist%" -T "TOTALTRACKS=%totaltracks%" -o "$output" -
format=FLAC
quality=lossless
compression_level=8
verify=true
utf8_tags=true

# FLAC Быстрый - компромисс скорость/размер
[flac_fast]
name=FLAC Fast (macOS)
description=Быстрое FLAC кодирование с хорошим сжатием
encoder_path_arm64=/opt/homebrew/bin/flac
encoder_path_intel=/usr/local/bin/flac
extension=flac
parameters=-5 -V --totally-silent --preserve-modtime --keep-foreign-metadata -T "ARTIST=%artist%" -T "TITLE=%title%" -T "ALBUM=%album%" -T "DATE=%date%" -T "GENRE=%genre%" -T "TRACKNUMBER=%tracknumber%" -T "ALBUMARTIST=%albumartist%" -T "TOTALTRACKS=%totaltracks%" -o "$output" -
format=FLAC
quality=lossless
compression_level=5
verify=true

# FLAC Commercial - 44.1kHz, 24-bit, compression level 4 for commercial releases
[flac_commercial]
name=FLAC Commercial (macOS)
description=FLAC commercial release format - 44.1kHz, 24-bit, preserves all source metadata and tags
encoder_path_arm64=/opt/homebrew/bin/flac
encoder_path_intel=/usr/local/bin/flac
extension=flac
parameters=-4 -V --totally-silent --preserve-modtime --keep-foreign-metadata -T "ARTIST=%artist%" -T "TITLE=%title%" -T "ALBUM=%album%" -T "DATE=%date%" -T "GENRE=%genre%" -T "TRACKNUMBER=%tracknumber%" -T "ALBUMARTIST=%albumartist%" -T "TOTALTRACKS=%totaltracks%" -o "$output" -
format=FLAC
quality=lossless
compression_level=4
sample_rate=44100
bit_depth=24
verify=true
utf8_tags=true
preserve_all_metadata=true
preserve_source_tags=true
commercial_ready=true

# FLAC Commercial 16-bit - 44.1kHz, 16-bit, compression level 4 for commercial releases
[flac_commercial_16-bit]
name=FLAC Commercial 16-bit (macOS)
description=FLAC commercial release format - 44.1kHz, 16-bit, preserves all source metadata and tags
encoder_path_arm64=/opt/homebrew/bin/flac
encoder_path_intel=/usr/local/bin/flac
extension=flac
parameters=-4 -V --totally-silent --preserve-modtime --keep-foreign-metadata -T "ARTIST=%artist%" -T "TITLE=%title%" -T "ALBUM=%album%" -T "DATE=%date%" -T "GENRE=%genre%" -T "TRACKNUMBER=%tracknumber%" -T "ALBUMARTIST=%albumartist%" -T "TOTALTRACKS=%totaltracks%" -o "$output" -
format=FLAC
quality=lossless
compression_level=4
sample_rate=44100
bit_depth=16
verify=true
utf8_tags=true
preserve_all_metadata=true
preserve_source_tags=true
commercial_ready=true

# MP3 320 CBR - максимальное качество MP3
[mp3_320_cbr]
name=MP3 320 kbps CBR (macOS)
description=MP3 320 kbps постоянный битрейт для максимальной совместимости
encoder_path_arm64=/opt/homebrew/bin/lame
encoder_path_intel=/usr/local/bin/lame
extension=mp3
parameters=-b 320 -h -m j --cbr --add-id3v2 --id3v2-only --ignore-tag-errors --preserve-modtime --tt "%title%" --ta "%artist%" --tl "%album%" --ty "%date%" --tg "%genre%" --tn "%tracknumber%/%totaltracks%" --TPE2 "%albumartist%" --tv "TPE1=%artist%" --tv "TIT2=%title%" --tv "TALB=%album%" --tv "TDRC=%date%" --tv "TCON=%genre%" --tv "TRCK=%tracknumber%" --tv "TPE2=%albumartist%" - "$output"
format=MP3
quality=320kbps_cbr
id3_version=2.4
encoding=utf8

# MP3 V0 VBR - высокое качество с переменным битрейтом
[mp3_v0_vbr]
name=MP3 V0 VBR (macOS)
description=MP3 переменный битрейт высокого качества (~245 kbps)
encoder_path_arm64=/opt/homebrew/bin/lame
encoder_path_intel=/usr/local/bin/lame
extension=mp3
parameters=-V 0 -h -m j --vbr-new --add-id3v2 --id3v2-only --ignore-tag-errors --preserve-modtime --tt "%title%" --ta "%artist%" --tl "%album%" --ty "%date%" --tg "%genre%" --tn "%tracknumber%/%totaltracks%" --TPE2 "%albumartist%" --tv "TPE1=%artist%" --tv "TIT2=%title%" --tv "TALB=%album%" --tv "TDRC=%date%" --tv "TCON=%genre%" --tv "TRCK=%tracknumber%" --tv "TPE2=%albumartist%" - "$output"
format=MP3
quality=v0_vbr
encoding=utf8

# MP3 V2 VBR - стандартное качество
[mp3_v2_vbr]
name=MP3 V2 VBR (macOS)
description=MP3 переменный битрейт стандартного качества (~190 kbps)
encoder_path_arm64=/opt/homebrew/bin/lame
encoder_path_intel=/usr/local/bin/lame
extension=mp3
parameters=-V 2 -h -m j --vbr-new --add-id3v2 --id3v2-only --ignore-tag-errors --preserve-modtime --tt "%title%" --ta "%artist%" --tl "%album%" --ty "%date%" --tg "%genre%" --tn "%tracknumber%/%totaltracks%" --TPE2 "%albumartist%" --tv "TPE1=%artist%" --tv "TIT2=%title%" --tv "TALB=%album%" --tv "TDRC=%date%" --tv "TCON=%genre%" --tv "TRCK=%tracknumber%" --tv "TPE2=%albumartist%" - "$output"
format=MP3
quality=v2_vbr

# MP3 Commercial - 44.1kHz, 320 kbps CBR for commercial releases
[mp3_commercial]
name=MP3 Commercial (macOS)
description=MP3 commercial release format - 44.1kHz, 24-bit, 192 kbps CBR, preserves all source metadata
encoder_path_arm64=/opt/homebrew/bin/lame
encoder_path_intel=/usr/local/bin/lame
extension=mp3
parameters=-b 192 -h -m j --cbr --resample 44.1 --bitwidth 24 --add-id3v2 --id3v2-only --ignore-tag-errors --preserve-modtime --tt "%title%" --ta "%artist%" --tl "%album%" --ty "%date%" --tg "%genre%" --tn "%tracknumber%/%totaltracks%" --TPE2 "%albumartist%" --tv "TPE1=%artist%" --tv "TIT2=%title%" --tv "TALB=%album%" --tv "TDRC=%date%" --tv "TCON=%genre%" --tv "TRCK=%tracknumber%" --tv "TPE2=%albumartist%" - "$output"
format=MP3
quality=192kbps_cbr
sample_rate=44100
bit_depth=24
id3_version=2.4
encoding=utf8
preserve_all_metadata=true
commercial_ready=true

# MP3 Commercial 16-bit - 44.1kHz, 192 kbps CBR for commercial releases
[mp3_commercial_16-bit]
name=MP3 Commercial 16-bit (macOS)
description=MP3 commercial release format - 44.1kHz, 16-bit, 192 kbps CBR, preserves all source metadata
encoder_path_arm64=/opt/homebrew/bin/lame
encoder_path_intel=/usr/local/bin/lame
extension=mp3
parameters=-b 192 -h -m j --cbr --resample 44.1 --bitwidth 16 --add-id3v2 --id3v2-only --ignore-tag-errors --preserve-modtime --tt "%title%" --ta "%artist%" --tl "%album%" --ty "%date%" --tg "%genre%" --tn "%tracknumber%/%totaltracks%" --TPE2 "%albumartist%" --tv "TPE1=%artist%" --tv "TIT2=%title%" --tv "TALB=%album%" --tv "TDRC=%date%" --tv "TCON=%genre%" --tv "TRCK=%tracknumber%" --tv "TPE2=%albumartist%" - "$output"
format=MP3
quality=192kbps_cbr
sample_rate=44100
bit_depth=16
id3_version=2.4
encoding=utf8
preserve_all_metadata=true
commercial_ready=true

# Opus высокое качество
[opus_high_quality]
name=Opus High Quality (macOS)
description=Opus высокоэффективное кодирование (~192 kbps)
encoder_path_arm64=/opt/homebrew/bin/opusenc
encoder_path_intel=/usr/local/bin/opusenc
extension=opus
parameters=--bitrate 192 --comp 10 --framesize 20 --expect-loss 0 --preserve-modtime --artist "%artist%" --title "%title%" --album "%album%" --date "%date%" --genre "%genre%" --comment "ALBUMARTIST=%albumartist%" --comment "TRACKNUMBER=%tracknumber%" --comment "TOTALTRACKS=%totaltracks%" --comment "ORIGINALARTIST=%artist%" --comment "ORIGINALTITLE=%title%" --comment "ORIGINALALBUM=%album%" --comment "ORIGINALDATE=%date%" - "$output"
format=Opus
quality=192kbps
compression=10

# Opus стандартное качество
[opus_standard]
name=Opus Standard (macOS)
description=Opus стандартное качество (~128 kbps)
encoder_path_arm64=/opt/homebrew/bin/opusenc
encoder_path_intel=/usr/local/bin/opusenc
extension=opus
parameters=--bitrate 128 --comp 10 --framesize 20 --preserve-modtime --artist "%artist%" --title "%title%" --album "%album%" --date "%date%" --genre "%genre%" --comment "ALBUMARTIST=%albumartist%" --comment "TRACKNUMBER=%tracknumber%" --comment "TOTALTRACKS=%totaltracks%" --comment "ORIGINALARTIST=%artist%" --comment "ORIGINALTITLE=%title%" --comment "ORIGINALALBUM=%album%" --comment "ORIGINALDATE=%date%" - "$output"
format=Opus
quality=128kbps

# AAC через FFmpeg (если доступен)
[aac_ffmpeg_high]
name=AAC High Quality (FFmpeg)
description=AAC высокое качество через FFmpeg
encoder_path_arm64=/opt/homebrew/bin/ffmpeg
encoder_path_intel=/usr/local/bin/ffmpeg
extension=m4a
parameters=-i - -c:a aac -b:a 256k -map_metadata 0 -metadata title="%title%" -metadata artist="%artist%" -metadata album="%album%" -metadata date="%date%" -metadata genre="%genre%" -metadata track="%tracknumber%/%totaltracks%" -metadata album_artist="%albumartist%" -metadata TPE1="%artist%" -metadata TIT2="%title%" -metadata TALB="%album%" -metadata TDRC="%date%" -metadata TCON="%genre%" -metadata TRCK="%tracknumber%" -metadata TPE2="%albumartist%" "$output"
format=AAC
quality=256kbps

# Apple Lossless через FFmpeg
[alac_ffmpeg]
name=Apple Lossless (FFmpeg)
description=Apple Lossless через FFmpeg
encoder_path_arm64=/opt/homebrew/bin/ffmpeg
encoder_path_intel=/usr/local/bin/ffmpeg
extension=m4a
parameters=-i - -c:a alac -map_metadata 0 -metadata title="%title%" -metadata artist="%artist%" -metadata album="%album%" -metadata date="%date%" -metadata genre="%genre%" -metadata track="%tracknumber%/%totaltracks%" -metadata album_artist="%albumartist%" -metadata TPE1="%artist%" -metadata TIT2="%title%" -metadata TALB="%album%" -metadata TDRC="%date%" -metadata TCON="%genre%" -metadata TRCK="%tracknumber%" -metadata TPE2="%albumartist%" "$output"
format=ALAC
quality=lossless

# Структуры папок для разных случаев
[Output Folder Structures]
default=%albumartist%/[%date%] %album%/%tracknumber%. %title%
single_artist=%artist%/[%date%] %album%/%tracknumber%. %title%
compilation=Compilations/[%date%] %album%/%tracknumber%. %artist% - %title%
genre_based=%genre%/%albumartist%/[%date%] %album%/%tracknumber%. %title%
year_based=[%date%]/%albumartist%/%album%/%tracknumber%. %title%

# Настройки для macOS специфичные
[macOS Specific Settings]
# Символы, безопасные для файловой системы macOS
safe_characters=true
replace_colon_with=" -"
replace_slash_with="∕"  # Unicode division slash
replace_question_with="？"  # Unicode question mark
max_filename_length=255
normalize_unicode=true

# Настройки качества по умолчанию для разных профилей
[Profile Defaults]
minimal=flac_fast,mp3_v2_vbr
standard=flac_lossless,flac_commercial,flac_commercial_16-bit,mp3_320_cbr,mp3_v0_vbr,mp3_commercial_16-bit,opus_standard
professional=flac_lossless,flac_commercial,flac_commercial_16-bit,mp3_320_cbr,mp3_v0_vbr,mp3_commercial,mp3_commercial_16-bit,opus_high_quality,aac_ffmpeg_high,alac_ffmpeg

# Интеграция с macOS утилитами
[macOS Integration]
use_afconvert=false  # Системный конвертер (ограниченный)
use_homebrew_paths=true
detect_architecture=true  # Автоопределение ARM64 vs Intel
spotlight_metadata=true
quicklook_support=true

# Автоматические настройки на основе архитектуры
[Architecture Detection]
# Скрипт для определения правильного пути к кодировщику
detect_encoder_path() {
  local encoder="$1"
  if [[ $(uname -m) == "arm64" ]]; then
    echo "/opt/homebrew/bin/$encoder"
  else
    echo "/usr/local/bin/$encoder"
  fi
}

# Проверка наличия кодировщика
verify_encoder() {
  local encoder_path="$1"
  if [[ -x "$encoder_path" ]]; then
    return 0
  else
    echo "Кодировщик не найден: $encoder_path"
    echo "Попробуйте: brew install $(basename "$encoder_path")"
    return 1
  fi
}

# Примечания по использованию
[Usage Notes]
note1="Перед использованием убедитесь, что кодировщики установлены через Homebrew"
note2="Для Apple Silicon используется /opt/homebrew/bin/, для Intel /usr/local/bin/"
note3="Все пресеты оптимизированы для Unicode и macOS файловой системы"
note4="Используйте соответствующие пресеты для вашего профиля (minimal/standard/professional)"
note5="При проблемах с путями проверьте установку: brew list flac lame opus-tools ffmpeg"

# Команды для проверки установки кодировщиков
[Installation Check Commands]
check_flac="flac --version"
check_lame="lame --version"
check_opus="opusenc --version"
check_ffmpeg="ffmpeg -version"
install_all="brew install flac lame opus-tools ffmpeg"
install_status_flac="✓ Установлен"
install_status_lame="✓ Установлен"
install_status_opus="⚠ Требуется установка: brew install opus-tools"
install_status_ffmpeg="⚠ Требуется установка: brew install ffmpeg"